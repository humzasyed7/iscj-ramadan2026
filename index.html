<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Support our fundraising campaign - Donate now!">
    <title>Donation Campaign - Non-Profit Organization</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="App">

        <header class="header" role="banner">
            <div class="logo-container">
                <h1 class="header-text" lang="en" dir="ltr" aria-label="Ramadan Donations">Ramadan Donations</h1>
            </div>
        </header>

        <!-- Fundraising thermometer removed -->

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Mission Statement -->
            <section class="content-block mission-section">
                <h2>Allah's Messenger (ﷺ) said:</h2>
                <p class="text-block">
                    "Take up good deeds only as much as you are able, for the best deeds are those done regularly even if they are few" (Musnad Ahmad 8600)
                </p>
            </section>

            <!-- Daily Donations Section -->
            <section class="donations-section">
                <h2>Daily Donations</h2>
                <div class="donations-grid">
                    <a href="https://form.jotform.com/260467960854165" class="donation-card" data-amount="1" data-recurring="true" data-period="D" data-interval="1" aria-label="Donate $1 daily">
                        <div class="donation-content">
                            <p class="donation-title">Daily Supporter</p>
                            <p class="donation-amount">$1/day</p>
                        </div>
                    </a>
                    <a href="https://form.jotform.com/260467960854165" class="donation-card" data-amount="5" data-recurring="true" data-period="D" data-interval="1" aria-label="Donate $5 daily">
                        <div class="donation-content">
                            <p class="donation-title">Daily Sustainer</p>
                            <p class="donation-amount">$5/day</p>
                        </div>
                    </a>
                    <a href="https://form.jotform.com/260467960854165" class="donation-card" data-amount="8" data-recurring="true" data-period="D" data-interval="1" aria-label="Donate $8 daily">
                        <div class="donation-content">
                            <p class="donation-title">Daily Champion</p>
                            <p class="donation-amount">$8/day</p>
                        </div>
                    </a>
                </div>
            </section>

            <!-- Recurring Donations Section -->
            <section class="donations-section">
                <h2>Monthly Donations</h2>
                <div class="donations-grid">
                    <a href="https://form.jotform.com/260467960854165" class="donation-card" data-amount="10" data-recurring="true" data-period="M" data-interval="1" aria-label="Donate $10 monthly">
                        <div class="donation-content">
                            <p class="donation-title">Monthly Supporter</p>
                            <p class="donation-amount">$10/month</p>
                        </div>
                    </a>
                    <a href="https://form.jotform.com/260467960854165" class="donation-card" data-amount="25" data-recurring="true" data-period="M" data-interval="1" aria-label="Donate $25 monthly">
                        <div class="donation-content">
                            <p class="donation-title">Sustaining Friend</p>
                            <p class="donation-amount">$25/month</p>
                        </div>
                    </a>
                    <a href="https://form.jotform.com/260467960854165" class="donation-card" data-amount="50" data-recurring="true" data-period="M" data-interval="1" aria-label="Donate $50 monthly">
                        <div class="donation-content">
                            <p class="donation-title">Champion Circle</p>
                            <p class="donation-amount">$50/month</p>
                        </div>
                    </a>
                </div>
            </section>

            <!-- Consistency & Commitment Panel -->
            <section class="commitment-panel" id="commitment-panel">
                <h2 class="commitment-title">Consistency and Commitment</h2>
                <div class="commitment-toggle-row">
                    <button class="commitment-toggle" data-freq="D">Daily</button>
                    <button class="commitment-toggle" data-freq="W">Weekly</button>
                    <button class="commitment-toggle active" data-freq="M">Monthly</button>
                </div>
                <div class="commitment-amounts-row" id="commitment-amounts">
                    <!-- Dynamically populated -->
                </div>
                <button class="commitment-checkout-btn" id="commitment-checkout" disabled>Select an amount</button>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2026 Non-Profit Organization. All rights reserved.</p>
            <div class="footer-links">
                <a href="#privacy">Privacy Policy</a>
                <a href="#terms">Terms of Service</a>
                <a href="#contact">Contact Us</a>
            </div>
        </footer>
    </div>
</body>
    <script>
        (function(){
            // Placeholder Google Sheet ID - replace with your actual sheet ID
            const SHEET_ID = 'PLACEHOLDER_SHEET_ID';
            // Using the CSV export for the 'Total' sheet
            const SHEET_CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&sheet=Total`;
            const GOAL = 500000;
            const REFRESH_MS = 30000; // 30 seconds

            function parseNumber(value) {
                if (!value && value !== 0) return 0;
                const num = Number(String(value).replace(/[^0-9.-]+/g, ''));
                return Number.isFinite(num) ? num : 0;
            }

            async function fetchTotal() {
                try {
                    const res = await fetch(SHEET_CSV_URL);
                    if (!res.ok) throw new Error('Network response was not ok');
                    const text = await res.text();
                    const firstLine = text.trim().split(/\r?\n/)[0] || '';
                    // crude CSV first-cell extraction (handles optional quotes)
                    let cell = firstLine.split(',')[0] || '';
                    cell = cell.replace(/^"|"$/g, '').trim();
                    const total = parseNumber(cell);
                    updateThermometer(total);
                } catch (err) {
                    console.warn('Failed to fetch sheet total:', err);
                }
            }

            function updateThermometer(total) {
                const amountEl = document.querySelector('.current-amount');
                const fillEl = document.querySelector('.thermometer-fill');
                const percentStat = document.querySelector('.progress-stats .stat-item:nth-child(2) .stat-number');
                const goalLabel = document.querySelector('.goal-label');

                const percent = Math.max(0, Math.min(100, (total / GOAL) * 100));

                if (amountEl) amountEl.textContent = '$' + total.toLocaleString();
                if (fillEl) fillEl.style.height = percent + '%';
                if (percentStat) percentStat.textContent = Math.round(percent) + '%';
                if (goalLabel) goalLabel.textContent = `raised of $${GOAL.toLocaleString()} goal`;
            }

            // Initial fetch and periodic refresh
            // PayPal integration: set your PayPal email or merchant ID below.
            // If left as the placeholder, cards will keep their original links (JotForm).
            const PAYPAL_BUSINESS = 'iscjlit@iscj.org';

            function buildPaypalUrl(amount, itemName = 'Donation', recurring = false, interval = 1, period = 'M') {
                const base = 'https://www.paypal.com/cgi-bin/webscr';
                const params = new URLSearchParams();

                if (recurring) {
                    // Subscriptions: use _xclick-subscriptions with a3, p3, t3
                    params.set('cmd', '_xclick-subscriptions');
                    params.set('business', PAYPAL_BUSINESS);
                    params.set('a3', Number(amount).toFixed(2));
                    params.set('p3', String(interval));
                    params.set('t3', period); // D,W,M,Y
                    params.set('src', '1'); // make payments recur
                    params.set('sra', '1'); // reattempt on failure
                    params.set('item_name', itemName);
                    params.set('currency_code', 'USD');
                } else {
                    // One-time donation
                    params.set('cmd', '_donations');
                    params.set('business', PAYPAL_BUSINESS);
                    params.set('amount', Number(amount).toFixed(2));
                    params.set('currency_code', 'USD');
                    params.set('item_name', itemName);
                }

                return base + '?' + params.toString();
            }

            // Attach click handlers to donation cards — opens PayPal in a new tab.
            document.querySelectorAll('.donation-card').forEach(card => {
                card.addEventListener('click', function (e) {
                    const amount = card.dataset.amount;
                    const recurring = card.dataset.recurring === 'true';
                    const period = (card.dataset.period || 'M').toUpperCase();
                    const interval = parseInt(card.dataset.interval || '1', 10) || 1;

                    // If PayPal not configured, fall back to the anchor's href (JotForm)
                    if (!amount || !PAYPAL_BUSINESS || PAYPAL_BUSINESS.includes('YOUR_PAYPAL')) {
                        return; // allow default navigation
                    }

                    e.preventDefault();
                    const title = card.querySelector('.donation-title')?.textContent?.trim() || 'Donation';
                    const url = buildPaypalUrl(amount, title, recurring, interval, period);
                    window.open(url, '_blank');
                });
            });

            fetchTotal();
            setInterval(fetchTotal, REFRESH_MS);

            // ── Consistency & Commitment Panel ──
            (function commitmentPanel() {
                const presets = {
                    D: [1, 5, 8],
                    W: [5, 15, 25],
                    M: [10, 25, 50]
                };
                const freqLabels = { D: 'Daily', W: 'Weekly', M: 'Monthly' };
                const freqSuffix = { D: '/day', W: '/week', M: '/month' };

                let selectedFreq = 'M';
                let selectedAmt = null;

                const toggleBtns = document.querySelectorAll('.commitment-toggle');
                const amountsRow = document.getElementById('commitment-amounts');
                const checkoutBtn = document.getElementById('commitment-checkout');

                function renderAmounts(freq) {
                    amountsRow.innerHTML = '';
                    presets[freq].forEach(amt => {
                        const btn = document.createElement('button');
                        btn.className = 'commitment-amount-btn';
                        btn.textContent = '$' + amt;
                        btn.dataset.amount = amt;
                        btn.addEventListener('click', () => {
                            selectedAmt = amt;
                            document.querySelectorAll('.commitment-amount-btn').forEach(b => b.classList.remove('active'));
                            btn.classList.add('active');
                            checkoutBtn.disabled = false;
                            checkoutBtn.textContent = 'Checkout';
                        });
                        amountsRow.appendChild(btn);
                    });
                }

                toggleBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        toggleBtns.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        selectedFreq = btn.dataset.freq;
                        selectedAmt = null;
                        checkoutBtn.disabled = true;
                        checkoutBtn.textContent = 'Select an amount';
                        renderAmounts(selectedFreq);
                    });
                });

                checkoutBtn.addEventListener('click', () => {
                    if (!selectedAmt) return;
                    const itemName = 'Ramadan ' + freqLabels[selectedFreq] + ' Donation';
                    const url = buildPaypalUrl(selectedAmt, itemName, true, 1, selectedFreq);
                    window.open(url, '_blank');
                });

                // Initial render (Monthly)
                renderAmounts(selectedFreq);
            })();
        })();
    </script>
</html>
